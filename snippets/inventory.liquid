{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
VARIANT INVENTORY COMPONENT
----------------------------------------------------------------------------------------------------------------------

This component is used to display the inventory of a given variant

********************************************
Supported variables
********************************************

* variant: the variant from which the inventory is extracted. If the variant is nil, then nothing is rendered
* show_in_stock_quantity: decide if the quantity in stock is shown or not
* low_threshold: the inventory quantity threshold below which the inventory is shown as "red"
* show_progress_bar: if true, a progress bar is added
* progress_bar_max_value: the value used as a max value to calculate the progress advancement
{%- endcomment -%}

{%- capture inventory_for_variant -%}
  {%- if variant -%}
    {%- liquid
      if variant.available
        if variant.inventory_management and variant.inventory_policy == 'deny' and variant.inventory_quantity <= low_threshold and low_threshold > 0
          assign inventory_status = 'warning'

          if show_in_stock_quantity
            assign inventory_text = 'product.inventory.low_stock_with_quantity_count' | t: count: variant.inventory_quantity
          else 
            assign inventory_text = 'product.inventory.low_stock' | t
          endif
        else
          if variant.inventory_policy == 'continue' and variant.inventory_quantity <= 0 and variant.requires_shipping
            if variant.incoming and variant.next_incoming_date
              assign next_incoming_date = variant.next_incoming_date | date: format: 'date'
              assign inventory_status = 'warning'
              assign inventory_text = 'product.inventory.incoming_stock' | t: next_incoming_date: next_incoming_date
            else
              assign inventory_status = 'warning'
              assign inventory_text = 'product.inventory.oversell_stock' | t
            endif
          else
            assign inventory_status = 'success'

            if show_in_stock_quantity
              assign inventory_text = 'product.inventory.in_stock_with_quantity_count' | t: count: variant.inventory_quantity
            else
              assign inventory_text = 'product.inventory.in_stock' | t
            endif
          endif
        endif
      elsif variant.incoming
        if variant.next_incoming_date
          assign next_incoming_date = variant.next_incoming_date | date: format: 'date'
          assign inventory_status = 'warning'
          assign inventory_text = 'product.inventory.incoming_stock' | t: next_incoming_date: next_incoming_date
        else
          assign inventory_status = 'warning'
          assign inventory_text = 'product.inventory.oversell_stock' | t
        endif
      else
        assign inventory_status = 'error'
        assign inventory_text = 'product.inventory.out_of_stock' | t
      endif

      if variant.inventory_management
        assign inventory_quantity = variant.inventory_quantity | at_least: 0
      else
        assign inventory_quantity = progress_bar_max_value
      endif
    -%}
<span class="mar-flx">
  <span class="nna">
    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" width="25">
  <path style="fill:#FF6536;" d="M54.211,249.7c0,0,20.228,29.717,62.624,54.871c0,0-30.705-259.502,169.358-304.571
    c-51.257,188.121,65.2,241.174,107.651,141.786c70.893,94.651,17.066,177.229,17.066,177.229
    c29.069,4.188,53.487-27.57,53.487-27.57c0.218,3.912,0.34,7.851,0.34,11.818C464.738,418.545,371.283,512,256,512
    S47.262,418.545,47.262,303.262C47.262,284.744,49.686,266.794,54.211,249.7z"></path>
  <path style="fill:#FF421D;" d="M464.398,291.445c0,0-24.418,31.758-53.487,27.57c0,0,53.827-82.578-17.066-177.229
    C351.394,241.174,234.937,188.121,286.194,0C275.479,2.414,265.431,5.447,256,9.018V512c115.283,0,208.738-93.455,208.738-208.738
    C464.738,299.295,464.616,295.357,464.398,291.445z"></path>
  <path style="fill:#FBBF00;" d="M164.456,420.456C164.456,471.014,205.442,512,256,512s91.544-40.986,91.544-91.544
    c0-27.061-11.741-51.379-30.408-68.138c-35.394,48.085-85.832-24.856-46.524-78.122
    C270.612,274.196,164.456,287.499,164.456,420.456z"></path>
  <path style="fill:#FFA900;" d="M347.544,420.456c0-27.061-11.741-51.379-30.408-68.138c-35.394,48.085-85.832-24.856-46.524-78.122
    c0,0-5.768,0.725-14.612,3.516V512C306.558,512,347.544,471.014,347.544,420.456z"></path>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
  <g>
  </g>
</svg>
    </span>
    <span><span class="mar-ne">HURRY UP! ONLY </span>{{- inventory_text -}}</span>
    </span>
  {%- endif -%}
{%- endcapture -%}

{%- if inventory_for_variant != blank -%}
  <variant-inventory class="inventory text-{{ inventory_status }}">
    {{- inventory_for_variant -}}

    {%- if show_progress_bar -%}
      <progress-bar class="progress-bar" animate-on-scroll aria-valuenow="{{ inventory_quantity }}" aria-valuemax="{{ progress_bar_max_value | default: 50 }}"></progress-bar>
    {%- endif -%}
  </variant-inventory>
{%- endif -%}